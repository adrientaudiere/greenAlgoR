---
output: github_document
always_allow_html: yes
bibliography: pkgdown/assets/bibliography.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- devtools::build_readme() -->

![R](https://img.shields.io/badge/r-%23276DC3.svg?style=for-the-badge&logo=r&logoColor=white)
[![License: GPL v3](https://img.shields.io/badge/License-GPL%20v3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![DOI](https://zenodo.org/badge/888940618.svg)](https://doi.org/10.5281/zenodo.14184331)
[![codecov](https://codecov.io/gh/adrientaudiere/greenAlgoR/graph/badge.svg?token=NXFRSIKYC0)](https://app.codecov.io/gh/adrientaudiere/greenAlgoR) 
[![CodeFactor](https://www.codefactor.io/repository/github/adrientaudiere/greenalgor/badge/master)](https://www.codefactor.io/repository/github/adrientaudiere/greenalgor/overview/master) 

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  message = FALSE
)
```


# greenAlgoR: Carbon Footprint Estimation for R Computations

**Calculate the environmental impact of your R computations** ğŸŒ±

The `greenAlgoR` package provides tools to estimate the carbon footprint and energy consumption of computational tasks in R. Based on the Green Algorithms framework (@lannelongue_green_2021), this package helps researchers and data scientists understand and minimize the environmental impact of their computational work.

## âœ¨ Key Features

- ğŸ” **Calculate CO2 emissions** from R computations based on runtime, CPU, and memory usage
- ğŸŒ **Location-aware estimates** using regional carbon intensity data
- ğŸ¯ **Targets integration** for complete pipeline carbon footprint analysis  
- ğŸ“Š **Visualization tools** to compare and contextualize your footprint
- âš™ï¸ **Flexible configuration** for different hardware specifications

## ğŸš€ Quick Start

```{r, eval=FALSE}
library(greenAlgoR)

# Calculate footprint for a 2-hour computation
result <- ga_footprint(runtime_h = 2, location_code = "WORLD")
result$carbon_footprint_total_gCO2  # CO2 emissions in grams

# For your current R session
session_footprint <- ga_footprint(runtime_h = "session")

# For targets pipelines (in a targets project)
targets_footprint <- ga_targets()
```

## Installation

greenAlgoR is not available on CRAN for the moment. You can install the stable development version from GitHub with:

```{r, eval=FALSE}
# Install from GitHub (development version)
if (!require("devtools", quietly = TRUE)) {
  install.packages("devtools")
}
devtools::install_github("adrientaudiere/greenAlgoR")
```

## Scientific Foundation

### The Green Algorithms Framework

This package implements the methodology from @lannelongue_green_2021, which provides a standardized approach to quantifying the carbon footprint of computational research. The framework considers:

- **Energy consumption**: Based on CPU usage, memory requirements, and runtime
- **Carbon intensity**: Varies by geographical location and energy sources  
- **Hardware efficiency**: Different processors and systems have varying power draws
- **Infrastructure**: Data center efficiency (PUE - Power Usage Effectiveness) 

### The Algorithm

The carbon footprint is calculated by estimating the energy draw of the algorithm and the carbon intensity of producing this energy at a given location:

$$\text{carbon footprint} = \text{energy needed} \times \text{carbon intensity}$$

Where the energy needed is:

$$\text{runtime} \times (\text{power draw for cores} \times \text{usage} + \text{power draw for memory}) \times \text{PUE} \times \text{PSF}$$

The key factors are:
- **Power draw for cores**: Depends on CPU model and number of cores
- **Memory power draw**: Based on available RAM memory
- **Usage factor**: Corrects for actual core utilization (default: 100%)
- **PUE**: Power Usage Effectiveness for data center efficiency
- **PSF**: Pragmatic Scaling Factor for multiple runs
- **Carbon intensity**: Location-dependent based on energy sources

## ğŸ“– Examples

```{r}
library("greenAlgoR")
```

### Basic Usage

#### Simple Calculation

```{r}
# Calculate footprint for a 2-hour computation
result <- ga_footprint(
  runtime_h = 2,
  location_code = "WORLD",  # Global average
  n_cores = 4,
  memory_ram = 16
)

cat("Carbon footprint:", result$carbon_footprint_total_gCO2, "g CO2\n")
cat("Energy consumption:", result$energy_needed_kWh, "kWh\n")
```

#### Using CPU Model

```{r}
# Specify exact CPU model (automatically sets cores and TDP)
fp_specific <- ga_footprint(
  runtime_h = 1, 
  cpu_model = "Core i3-10300",
  location_code = "FR"  # France (low carbon intensity)
)

fp_specific$carbon_footprint_total_gCO2
```

#### Location Comparison

```{r}
# Compare carbon footprint across different locations
locations <- c("WORLD", "FR", "US", "NO", "CN")
footprints <- sapply(locations, function(loc) {
  ga_footprint(runtime_h = 1, location_code = loc)$carbon_footprint_total_gCO2
})

comparison <- data.frame(Location = locations, CO2_grams = footprints)
print(comparison)
```


### Visualization

```{r plot-basic}
#| fig.alt: >
#|   Barplot comparing carbon footprint of computation with reference activities
#|   like flights, streaming, and other everyday activities

# Create a simple comparison plot
fp_example <- ga_footprint(runtime_h = 4, n_cores = 4, memory_ram = 16)

# Simple reference comparison
ref_subset <- fp_example$ref_value[1:5, ]  # Top 5 reference activities
ref_subset$type <- "Reference"

# Add our computation
our_computation <- data.frame(
  variable = "Our Computation",
  value = fp_example$carbon_footprint_total_gCO2,
  prop_footprint = NA,
  type = "Computation"
)

plot_data <- rbind(ref_subset[, c("variable", "value", "type")], 
                   our_computation[, c("variable", "value", "type")])
plot_data$value <- as.numeric(plot_data$value)

ggplot(plot_data, aes(x = reorder(variable, value), y = value, fill = type)) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(values = c("Reference" = "lightblue", 
                              "Computation" = "darkred")) +
  coord_flip() +
  labs(
    title = "Carbon Footprint Comparison", 
    x = "Activity", 
    y = "CO2 Emissions (g)",
    fill = "Type"
  ) +
  theme_minimal()
```

### Current R Session

Calculate the carbon footprint of your current R session:

```{r}
# Analyze current R session
fp_session <- ga_footprint(runtime_h = "session", add_storage_estimation = TRUE)
cat("Session footprint:", fp_session$carbon_footprint_total_gCO2, "g CO2\n")
cat("Session runtime:", fp_session$runtime_h, "hours\n")
```

### Targets Pipeline Integration

For `targets` workflows, calculate the complete pipeline footprint:

```{r, eval=FALSE}
# In a targets project directory
pipeline_footprint <- ga_targets(
  location_code = "FR",
  n_cores = 4,
  memory_ram = 16
)
pipeline_footprint$carbon_footprint_total_gCO2
```

## ğŸ“š Documentation

- **Getting Started**: See `vignette("greenAlgoR-intro")` for comprehensive examples
- **Targets Integration**: See `vignette("targets-integration")` for pipeline analysis
- **Function Reference**: Use `?ga_footprint` and `?ga_targets` for detailed documentation

## ğŸ¤ Contributing

We welcome contributions! Please:

1. Check existing [issues](https://github.com/adrientaudiere/greenAlgoR/issues) 
2. Submit bug reports or feature requests
3. Fork the repository and submit pull requests
4. Follow the existing code style and add tests for new features

## ğŸ’¡ Best Practices

- **Optimize your code**: Reduce runtime to minimize carbon footprint
- **Choose efficient hardware**: Match computational resources to your needs  
- **Consider location**: Run computations in regions with cleaner energy
- **Monitor regularly**: Track your carbon footprint across projects
- **Share awareness**: Include carbon footprint in research reporting

## ğŸ”„ Roadmap

- [ ] Submit to CRAN
- [ ] Allow custom carbon intensity values (e.g., from [Electricity Maps](https://app.electricitymaps.com/))
- [ ] Add more visualization options

## ğŸ“„ Citation

If you use `greenAlgoR` in your research, please cite both the package and the underlying methodology:

```
# For greenAlgoR package
TaudiÃ¨re, A. (2024). greenAlgoR: Carbon Footprint Estimation for R Computations. 
R package version 0.1.1. https://github.com/adrientaudiere/greenAlgoR

# For the Green Algorithms methodology  
Lannelongue, L., Grealey, J., Inouye, M. (2021). Green Algorithms: 
Quantifying the Carbon Footprint of Computation. Advanced Science, 8(12), 2100707.
https://doi.org/10.1002/advs.202100707
```

## âš–ï¸ License

GPL (>= 3) - see [LICENSE.md](LICENSE.md) for details.
