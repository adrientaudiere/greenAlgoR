<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using greenAlgoR with targets Pipelines • greenAlgoR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using greenAlgoR with targets Pipelines">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">greenAlgoR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/greenAlgoR-intro.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/targets-integration.html">Targets Integration</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrientaudiere/greenAlgoR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using greenAlgoR with targets Pipelines</h1>
                        <h4 data-toc-skip class="author">Adrien
Taudière</h4>
            
            <h4 data-toc-skip class="date">2025-09-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adrientaudiere/greenAlgoR/blob/master/vignettes/targets-integration.Rmd" class="external-link"><code>vignettes/targets-integration.Rmd</code></a></small>
      <div class="d-none name"><code>targets-integration.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>targets</code> package <span class="citation">(<strong>landau_targets_2021?</strong>)</span> provides
a powerful framework for reproducible computational workflows in R. The
<code>greenAlgoR</code> package seamlessly integrates with
<code>targets</code> to help you understand the environmental impact of
your entire data analysis pipeline.</p>
<p>This vignette demonstrates how to:</p>
<ul>
<li>Calculate carbon footprint for complete <code>targets</code>
pipelines</li>
<li>Identify the most carbon-intensive steps in your workflow</li>
<li>Optimize pipelines for environmental efficiency</li>
</ul>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/adrientaudiere/greenAlgoR" class="external-link">greenAlgoR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-targets-integration">Basic targets Integration<a class="anchor" aria-label="anchor" href="#basic-targets-integration"></a>
</h2>
<p>The <code><a href="../reference/ga_targets.html">ga_targets()</a></code> function analyzes your
<code>targets</code> pipeline and calculates the total carbon footprint
based on:</p>
<ul>
<li>Runtime of each target</li>
<li>Memory usage patterns</li>
<li>Storage requirements (optional)</li>
</ul>
<div class="section level3">
<h3 id="simple-example">Simple Example<a class="anchor" aria-label="anchor" href="#simple-example"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a simple targets example</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_dir.html" class="external-link">tar_dir</a></span><span class="op">(</span><span class="op">{</span> <span class="co"># tar_dir() runs code from a temp dir for CRAN compatibility</span></span>
<span></span>
<span>  <span class="co"># Define a simple pipeline</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_script.html" class="external-link">tar_script</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>          name <span class="op">=</span> <span class="va">data_prep</span>,</span>
<span>          command <span class="op">=</span> <span class="op">{</span></span>
<span>            <span class="co"># Simulate data preparation (2 seconds)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>          name <span class="op">=</span> <span class="va">analysis</span>,</span>
<span>          command <span class="op">=</span> <span class="op">{</span></span>
<span>            <span class="co"># Simulate analysis (1 second)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">data_prep</span><span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>          name <span class="op">=</span> <span class="va">visualization</span>,</span>
<span>          command <span class="op">=</span> <span class="op">{</span></span>
<span>            <span class="co"># Simulate plotting (0.5 seconds)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data_prep</span><span class="op">$</span><span class="va">x</span>, <span class="va">data_prep</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span>            <span class="st">"plot_completed"</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ask <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Run the pipeline</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get metadata</span></span>
<span>  <span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_meta.html" class="external-link">tar_meta</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"seconds"</span>, <span class="st">"bytes"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate carbon footprint</span></span>
<span>  <span class="va">pipeline_footprint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_targets.html">ga_targets</a></span><span class="op">(</span></span>
<span>    tar_meta_raw <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>    location_code <span class="op">=</span> <span class="st">"WORLD"</span>,</span>
<span>    n_cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    TDP_per_core <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    memory_ram <span class="op">=</span> <span class="fl">8</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"Pipeline carbon footprint:"</span>,</span>
<span>    <span class="va">pipeline_footprint</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span>, <span class="st">"g CO2\n"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total runtime:"</span>, <span class="va">pipeline_footprint</span><span class="op">$</span><span class="va">runtime_h</span> <span class="op">*</span> <span class="fl">3600</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">data_prep</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">data_prep</span> completed [2s, 15.52 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">analysis</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">analysis</span> completed [1s, 47.54 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">visualization</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">visualization</span> completed [533ms, 67 B]</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ended pipeline [3.7s, 3 completed, 0 skipped]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   name          seconds bytes</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> data_prep       2.00  <span style="text-decoration: underline;">15</span>523</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> analysis        1.00  <span style="text-decoration: underline;">47</span>544</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> visualization   0.533    67</span></span>
<span><span class="co">#&gt; Pipeline carbon footprint: 0.02572536 g CO2</span></span>
<span><span class="co">#&gt; Total runtime: 3.54 seconds</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-pipeline-analysis">Advanced Pipeline Analysis<a class="anchor" aria-label="anchor" href="#advanced-pipeline-analysis"></a>
</h2>
<p>For more complex pipelines, you can get detailed insights:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_dir.html" class="external-link">tar_dir</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Create a more complex pipeline</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_script.html" class="external-link">tar_script</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">simulate_computation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span>, <span class="va">size</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">size</span> <span class="op">*</span> <span class="va">size</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">size</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">small_task</span>, <span class="fu">simulate_computation</span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">medium_task</span>, <span class="fu">simulate_computation</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">large_task</span>, <span class="fu">simulate_computation</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>          <span class="va">combined_analysis</span>,</span>
<span>          <span class="op">{</span></span>
<span>            <span class="co"># Combine results</span></span>
<span>            <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>              small <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">small_task</span><span class="op">)</span>,</span>
<span>              medium <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">medium_task</span><span class="op">)</span>,</span>
<span>              large <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">large_task</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># Additional processing time</span></span>
<span>            <span class="va">result</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ask <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_meta.html" class="external-link">tar_meta</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate footprint with storage estimation</span></span>
<span>  <span class="va">detailed_footprint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_targets.html">ga_targets</a></span><span class="op">(</span></span>
<span>    tar_meta_raw <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>    location_code <span class="op">=</span> <span class="st">"FR"</span>, <span class="co"># France has relatively low carbon intensity</span></span>
<span>    n_cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    TDP_per_core <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    memory_ram <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    add_storage_estimation <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Display breakdown</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total CO2 emissions:"</span>, <span class="va">detailed_footprint</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span>, <span class="st">"g\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"CPU contribution:"</span>, <span class="va">detailed_footprint</span><span class="op">$</span><span class="va">carbon_footprint_cores</span>, <span class="st">"g\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Memory contribution:"</span>, <span class="va">detailed_footprint</span><span class="op">$</span><span class="va">carbon_footprint_memory</span>, <span class="st">"g\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">detailed_footprint</span><span class="op">$</span><span class="va">power_draw_storage_kWh</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">storage_co2</span> <span class="op">&lt;-</span> <span class="va">detailed_footprint</span><span class="op">$</span><span class="va">carbon_intensity</span> <span class="op">*</span> <span class="va">detailed_footprint</span><span class="op">$</span><span class="va">power_draw_storage_kWh</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Storage contribution:"</span>, <span class="va">storage_co2</span>, <span class="st">"g\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">large_task</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">large_task</span> completed [5s, 7.68 MB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">medium_task</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">medium_task</span> completed [2s, 1.92 MB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">small_task</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">small_task</span> completed [502ms, 76.87 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">combined_analysis</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">combined_analysis</span> completed [1.4s, 49.99 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ended pipeline [9.5s, 4 completed, 0 skipped]</span></span>
<span><span class="co">#&gt; Total CO2 emissions: 0.0182604 g</span></span>
<span><span class="co">#&gt; CPU contribution: 0.0169924 g</span></span>
<span><span class="co">#&gt; Memory contribution: 0.001265934 g</span></span>
<span><span class="co">#&gt; Storage contribution: 2.065548e-06 g</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-different-configurations">Comparing Different Configurations<a class="anchor" aria-label="anchor" href="#comparing-different-configurations"></a>
</h2>
<p>You can compare how different hardware configurations affect your
pipeline’s carbon footprint:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_dir.html" class="external-link">tar_dir</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Use the same pipeline as above</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_script.html" class="external-link">tar_script</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">simulate_computation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span>, <span class="va">size</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">size</span> <span class="op">*</span> <span class="va">size</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">size</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">task1</span>, <span class="fu">simulate_computation</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">task2</span>, <span class="fu">simulate_computation</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">task3</span>, <span class="fu">simulate_computation</span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ask <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_meta.html" class="external-link">tar_meta</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compare different configurations</span></span>
<span>  <span class="va">configs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Laptop"</span>, <span class="st">"Desktop"</span>, <span class="st">"Server"</span><span class="op">)</span>,</span>
<span>    Cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>    TDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>    RAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">16</span>, <span class="fl">64</span><span class="op">)</span>,</span>
<span>    Location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WORLD"</span>, <span class="st">"FR"</span>, <span class="st">"NO"</span><span class="op">)</span> <span class="co"># Different locations</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate footprint for each configuration</span></span>
<span>  <span class="va">configs</span><span class="op">$</span><span class="va">CO2_emissions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">cores</span>, <span class="va">tdp</span>, <span class="va">ram</span>, <span class="va">loc</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ga_targets.html">ga_targets</a></span><span class="op">(</span></span>
<span>      tar_meta_raw <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>      n_cores <span class="op">=</span> <span class="va">cores</span>,</span>
<span>      TDP_per_core <span class="op">=</span> <span class="va">tdp</span>,</span>
<span>      memory_ram <span class="op">=</span> <span class="va">ram</span>,</span>
<span>      location_code <span class="op">=</span> <span class="va">loc</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span></span>
<span>  <span class="op">}</span>, <span class="va">configs</span><span class="op">$</span><span class="va">Cores</span>, <span class="va">configs</span><span class="op">$</span><span class="va">TDP</span>, <span class="va">configs</span><span class="op">$</span><span class="va">RAM</span>, <span class="va">configs</span><span class="op">$</span><span class="va">Location</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">configs</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">task1</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">task1</span> completed [1s, 307.24 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">task2</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">task2</span> completed [2s, 691.03 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">task3</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">task3</span> completed [1.5s, 480.03 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ended pipeline [4.7s, 3 completed, 0 skipped]</span></span>
<span><span class="co">#&gt;    Config Cores TDP RAM Location CO2_emissions</span></span>
<span><span class="co">#&gt; 1  Laptop     2  10   8    WORLD    0.02286206</span></span>
<span><span class="co">#&gt; 2 Desktop     8  15  16       FR    0.01352859</span></span>
<span><span class="co">#&gt; 3  Server    16  25  64       NO    0.00676439</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-pipeline-carbon-footprint">Visualizing Pipeline Carbon Footprint<a class="anchor" aria-label="anchor" href="#visualizing-pipeline-carbon-footprint"></a>
</h2>
<p>Create comprehensive visualizations of your pipeline’s environmental
impact:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_dir.html" class="external-link">tar_dir</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="co"># Create pipeline and get footprint with reference values</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_script.html" class="external-link">tar_script</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">data_load</span>, <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">preprocessing</span>, <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">data_load</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">modeling</span>, <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">data_load</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">data_load</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">postprocessing</span>, <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modeling</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ask <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_meta.html" class="external-link">tar_meta</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">pipeline_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_targets.html">ga_targets</a></span><span class="op">(</span></span>
<span>    tar_meta_raw <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>    location_code <span class="op">=</span> <span class="st">"WORLD"</span>,</span>
<span>    n_cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    memory_ram <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    add_ref_values <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create comprehensive visualization</span></span>
<span>  <span class="va">ref_data</span> <span class="op">&lt;-</span> <span class="va">pipeline_result</span><span class="op">$</span><span class="va">ref_value</span></span>
<span>  <span class="va">ref_data</span><span class="op">$</span><span class="va">category</span> <span class="op">&lt;-</span> <span class="st">"Reference Activities"</span></span>
<span></span>
<span>  <span class="co"># Add pipeline data</span></span>
<span>  <span class="va">pipeline_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="st">"Your Pipeline"</span>,</span>
<span>    value <span class="op">=</span> <span class="va">pipeline_result</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span>,</span>
<span>    prop_footprint <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    category <span class="op">=</span> <span class="st">"Your Computation"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Combine data</span></span>
<span>  <span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">ref_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"variable"</span>, <span class="st">"value"</span>, <span class="st">"category"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">pipeline_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"variable"</span>, <span class="st">"value"</span>, <span class="st">"category"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">plot_data</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create the plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">value</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">value</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">category</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Reference Activities"</span> <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>        <span class="st">"Your Computation"</span> <span class="op">=</span> <span class="st">"darkgreen"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Type"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Carbon Footprint of targets Pipeline"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>        <span class="st">"Total emissions:"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pipeline_result</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">"g CO2"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"Activity"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"CO2 Emissions (g, log scale)"</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Comparison with everyday reference activities"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">data_load</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">data_load</span> completed [1s, 38.47 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">modeling</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">modeling</span> completed [5s, 238.68 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">preprocessing</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">preprocessing</span> completed [3s, 38.59 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">postprocessing</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">postprocessing</span> completed [2s, 77.94 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ended pipeline [11.2s, 4 completed, 0 skipped]</span></span></code></pre></div>
<p><img src="figures/targets-pipeline-visualization-1.png" alt="Footprint value compared to references values such as 1 hour of Netflix streaming and a fly from London to Paris." width="100%"></p>
</div>
<div class="section level2">
<h2 id="target-level-analysis">Target-Level Analysis<a class="anchor" aria-label="anchor" href="#target-level-analysis"></a>
</h2>
<p>For detailed optimization, you might want to analyze individual
targets:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_dir.html" class="external-link">tar_dir</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_script.html" class="external-link">tar_script</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">quick_task</span>, <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>          <span class="st">"done"</span></span>
<span>        <span class="op">}</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">slow_task</span>, <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span>          <span class="st">"done"</span></span>
<span>        <span class="op">}</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">memory_intensive</span>, <span class="op">{</span></span>
<span>          <span class="co"># Simulate memory-intensive task</span></span>
<span>          <span class="va">big_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">big_matrix</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ask <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_meta.html" class="external-link">tar_meta</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Analyze each target separately</span></span>
<span>  <span class="va">target_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Target <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">name</span>,</span>
<span>    Runtime_sec <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">seconds</span>,</span>
<span>    Memory_MB <span class="op">=</span> <span class="va">metadata</span><span class="op">$</span><span class="va">bytes</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate individual footprints (simplified)</span></span>
<span>  <span class="va">target_analysis</span><span class="op">$</span><span class="va">CO2_estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">seconds</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sec</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ga_footprint.html">ga_footprint</a></span><span class="op">(</span></span>
<span>      runtime_h <span class="op">=</span> <span class="va">sec</span> <span class="op">/</span> <span class="fl">3600</span>,</span>
<span>      n_cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      memory_ram <span class="op">=</span> <span class="fl">8</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">target_analysis</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Identify the most carbon-intensive target</span></span>
<span>  <span class="va">most_intensive</span> <span class="op">&lt;-</span> <span class="va">target_analysis</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">target_analysis</span><span class="op">$</span><span class="va">CO2_estimate</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"\nMost carbon-intensive target:"</span>, <span class="va">most_intensive</span><span class="op">$</span><span class="va">Target</span>,</span>
<span>    <span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">most_intensive</span><span class="op">$</span><span class="va">CO2_estimate</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"g CO2 )\n"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">memory_intensive</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">memory_intensive</span> completed [3.3s, 31.13 kB]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">quick_task</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">quick_task</span> completed [501ms, 57 B]</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">+</span> <span style="color: #0000BB;">slow_task</span> dispatched</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">slow_task</span> completed [10s, 57 B]</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> ended pipeline [13.9s, 3 completed, 0 skipped]</span></span>
<span><span class="co">#&gt;             Target Runtime_sec    Memory_MB CO2_estimate</span></span>
<span><span class="co">#&gt; 1 memory_intensive       3.281 2.968979e-02  0.019505440</span></span>
<span><span class="co">#&gt; 2       quick_task       0.501 5.435944e-05  0.002978429</span></span>
<span><span class="co">#&gt; 3        slow_task      10.011 5.435944e-05  0.059515075</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Most carbon-intensive target: slow_task ( 0.06 g CO2 )</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="best-practices-for-sustainable-pipelines">Best Practices for Sustainable Pipelines<a class="anchor" aria-label="anchor" href="#best-practices-for-sustainable-pipelines"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Profile your pipeline</strong>: Use <code><a href="https://docs.ropensci.org/targets/reference/tar_meta.html" class="external-link">tar_meta()</a></code>
to identify bottlenecks</li>
<li>
<strong>Optimize slow targets</strong>: Focus on reducing runtime of
carbon-intensive steps</li>
<li>
<strong>Cache efficiently</strong>: Use <code>targets</code> caching
to avoid re-running expensive computations</li>
<li>
<strong>Choose appropriate hardware</strong>: Match computational
resources to task requirements</li>
<li>
<strong>Consider location</strong>: Run pipelines in regions with
cleaner energy if possible</li>
</ol>
</div>
<div class="section level2">
<h2 id="integration-with-workflow">Integration with Workflow<a class="anchor" aria-label="anchor" href="#integration-with-workflow"></a>
</h2>
<p>Include carbon footprint reporting as part of your standard
pipeline:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add to your _targets.R file</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>  <span class="va">pipeline_footprint</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># Calculate footprint after pipeline completion</span></span>
<span>    <span class="va">footprint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ga_targets.html">ga_targets</a></span><span class="op">(</span>location_code <span class="op">=</span> <span class="st">"FR"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Log the results</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>      <span class="st">"Pipeline carbon footprint:"</span>,</span>
<span>      <span class="va">footprint</span><span class="op">$</span><span class="va">carbon_footprint_total_gCO2</span>, <span class="st">"g CO2\n"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Save for reporting</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">footprint</span>, <span class="st">"results/carbon_footprint.rds"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">footprint</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Integrating <code>greenAlgoR</code> with <code>targets</code>
provides a powerful way to understand and optimize the environmental
impact of your computational workflows. By regularly monitoring carbon
footprint, you can make informed decisions about computational
efficiency and contribute to more sustainable research practices.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrien Taudière.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
